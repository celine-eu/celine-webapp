version: "3"

vars:
  APP_MODULE: celine.webapp.main:app
  HOST: 0.0.0.0
  PORT: 8014

tasks:
  run:
    desc: Run FastAPI BFF with reload (development)
    cmds:
      - .venv/bin/uvicorn {{.APP_MODULE}} --host {{.HOST}} --port {{.PORT}} --reload

  debug:
    desc: Run FastAPI BFF with reload (debug)
    cmds:
      - DEBUG_ATTACH=nowait DEBUG_PORT=4{{.PORT}} .venv/bin/uvicorn {{.APP_MODULE}} --host {{.HOST}} --port {{.PORT}} --reload

  migrate:
    desc: Run all pending database migrations
    cmds:
      - uv run alembic upgrade head

  migrate:create:
    desc: Create a new migration based on model changes
    cmds:
      - uv run alembic revision --autogenerate -m "{{.CLI_ARGS}}"
    vars:
      CLI_ARGS: '{{default "auto generated migration" .CLI_ARGS}}'
